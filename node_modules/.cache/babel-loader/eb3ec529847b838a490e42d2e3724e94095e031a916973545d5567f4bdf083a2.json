{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { computed, ref, watch } from 'vue';\nimport { useCartStore } from '@/store/cart.js';\nimport { useRouter } from 'vue-router';\nimport { useProductStore } from '@/store/product.js';\nexport default {\n  setup() {\n    const cartStore = useCartStore();\n    const router = useRouter();\n    const totalQuantity = computed(() => {\n      return cartStore.cart.reduce((sum, product) => sum + Number(product.quantity), 0);\n    });\n    const totalPrice = computed(() => cartStore.cart.reduce((sum, product) => sum + product.price * product.quantity, 0));\n    const errorMessage = ref('');\n    const availableQuantity = computed(() => product => {\n      const productInCart = cartStore.cart.find(item => item.product_id === product.product_id);\n      const quantityInCart = productInCart ? productInCart.quantity : 0;\n      return Array.from({\n        length: product.stock - quantityInCart\n      }, (_, i) => i + 1);\n    });\n    function removeProduct(productId) {\n      cartStore.removeProduct(productId);\n    }\n    function setQuantity(productId, quantity) {\n      const productStore = useProductStore();\n      const product = productStore.getProductById(productId);\n\n      // 現在のカート内の他の商品の数量と追加される数量の合計が在庫数を超えていないか確認\n      const totalQuantityInCart = cartStore.cart.reduce((sum, item) => item.product_id === productId ? 0 : sum + Number(item.quantity), 0);\n      if (totalQuantityInCart + Number(quantity) <= product.stock) {\n        cartStore.setQuantity(productId, Number(quantity));\n      }\n    }\n    function getQuantityInCart(product) {\n      const productInCart = cartStore.cart.find(item => item.product_id === product.product_id);\n      return productInCart ? productInCart.quantity : 0;\n    }\n    function formatNumber(value) {\n      return Number(value).toLocaleString();\n    }\n    function checkAndNavigate() {\n      if (totalQuantity.value === 0) {\n        // カート内の商品数が 0 の場合\n        errorMessage.value = '商品がカートに入っていません';\n      } else {\n        errorMessage.value = ''; // エラーメッセージをクリア\n        router.push('/cart-payment'); // ナビゲーションを実行\n      }\n    }\n\n    watch(() => cartStore.cart, () => {\n      cartStore.cart.forEach(product => {\n        if (!selectedQuantities.value[product.product_id]) {\n          selectedQuantities.value[product.product_id] = product.quantity;\n        }\n      });\n    });\n    const selectedQuantities = ref({});\n    return {\n      cart: cartStore.cart,\n      totalQuantity,\n      totalPrice,\n      removeProduct,\n      setQuantity,\n      formatNumber,\n      checkAndNavigate,\n      errorMessage,\n      getQuantityInCart,\n      availableQuantity,\n      selectedQuantities\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","watch","useCartStore","useRouter","useProductStore","setup","cartStore","router","totalQuantity","cart","reduce","sum","product","Number","quantity","totalPrice","price","errorMessage","availableQuantity","productInCart","find","item","product_id","quantityInCart","Array","from","length","stock","_","i","removeProduct","productId","setQuantity","productStore","getProductById","totalQuantityInCart","getQuantityInCart","formatNumber","value","toLocaleString","checkAndNavigate","push","forEach","selectedQuantities"],"sources":["/Users/kitakanta/Desktop/comvace関係/comvace6_1/src/views/CartListView.vue"],"sourcesContent":["<template>\n  <main>\n    <div class=\"cart-container\">\n      <h1 class=\"cart-title\">カート一覧</h1>\n      <div class=\"contents-container\">\n        <div class=\"left-container\">\n          <div class=\"cart-card\" v-for=\"product in cart\" :key=\"product.product_id\">\n            <figure class=\"product-photo-container\">\n              <img class=\"product-photo\" src=\"../assets/logo.png\" alt=\"商品\" />\n            </figure>\n            <div class=\"product-detail\">\n              <div class=\"product-name\">{{ product.product_name }}</div>\n              <div class=\"product-price\">¥ {{ formatNumber(product.price) }}</div>\n              <div class=\"select-button-container\">\n                <div class=\"product-amount-container\">\n                  <p class=\"amount\">個数：</p>\n                  <select\n                    class=\"product-amount\"\n                    size=\"1\"\n                    :value=\"getQuantityInCart(product)\"\n                    @change=\"setQuantity(product.product_id, $event.target.value)\"\n                  >\n                    <option v-for=\"num in availableQuantity(product)\" :key=\"num\" :selected=\"num === getQuantityInCart(product)\">{{ num }}</option>\n                  </select>\n                </div>\n                <div class=\"size-select-container\">\n                  <p class=\"size\">サイズ：{{ product.size }}</p>\n                </div>\n              </div>\n              <button class=\"delete-button\" @click=\"removeProduct(product.product_id)\">削除</button>\n            </div>\n          </div>\n        </div>\n        <div class=\"right-container\">\n          <div class=\"total-card\">\n            <div class=\"total-quantity\">合計個数 {{ totalQuantity }} 個</div>\n            <div class=\"total-price\">合計金額 {{ formatNumber(totalPrice) }} 円</div>\n            <button class=\"buying-procedure-button\" @click=\"checkAndNavigate\">購入手続きへ</button>\n            <p v-if=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</p>\n          </div>\n          <button class=\"return-to-product\">商品一覧へ戻る</button>\n        </div>\n      </div>\n    </div>\n  </main>\n</template>\n\n<script>\nimport { computed, ref, watch } from 'vue'\nimport { useCartStore } from '@/store/cart.js'\nimport { useRouter } from 'vue-router'\nimport { useProductStore } from '@/store/product.js'\n\nexport default {\n  setup() {\n    const cartStore = useCartStore()\n    const router = useRouter()\n    const totalQuantity = computed(() => {\n      return cartStore.cart.reduce((sum, product) => sum + Number(product.quantity), 0)\n    })\n    const totalPrice = computed(() =>\n      cartStore.cart.reduce((sum, product) => sum + product.price * product.quantity, 0)\n    )\n    const errorMessage = ref('')\n    const availableQuantity = computed(() => (product) => {\n      const productInCart = cartStore.cart.find((item) => item.product_id === product.product_id)\n      const quantityInCart = productInCart ? productInCart.quantity : 0\n      return Array.from({ length: product.stock - quantityInCart }, (_, i) => i + 1)\n    })\n\n    function removeProduct(productId) {\n      cartStore.removeProduct(productId)\n    }\n\n    function setQuantity(productId, quantity) {\n      const productStore = useProductStore()\n      const product = productStore.getProductById(productId)\n\n      // 現在のカート内の他の商品の数量と追加される数量の合計が在庫数を超えていないか確認\n      const totalQuantityInCart = cartStore.cart.reduce(\n        (sum, item) => (item.product_id === productId ? 0 : sum + Number(item.quantity)),\n        0\n      )\n      if (totalQuantityInCart + Number(quantity) <= product.stock) {\n        cartStore.setQuantity(productId, Number(quantity))\n      }\n    }\n\n    function getQuantityInCart(product) {\n      const productInCart = cartStore.cart.find((item) => item.product_id === product.product_id)\n      return productInCart ? productInCart.quantity : 0\n    }\n\n    function formatNumber(value) {\n      return Number(value).toLocaleString()\n    }\n\n    function checkAndNavigate() {\n      if (totalQuantity.value === 0) {\n        // カート内の商品数が 0 の場合\n        errorMessage.value = '商品がカートに入っていません'\n      } else {\n        errorMessage.value = '' // エラーメッセージをクリア\n        router.push('/cart-payment') // ナビゲーションを実行\n      }\n    }\n\n    watch(\n      () => cartStore.cart,\n      () => {\n        cartStore.cart.forEach((product) => {\n          if (!selectedQuantities.value[product.product_id]) {\n            selectedQuantities.value[product.product_id] = product.quantity\n          }\n        })\n      }\n    )\n\n    const selectedQuantities = ref({})\n    return {\n      cart: cartStore.cart,\n      totalQuantity,\n      totalPrice,\n      removeProduct,\n      setQuantity,\n      formatNumber,\n      checkAndNavigate,\n      errorMessage,\n      getQuantityInCart,\n      availableQuantity,\n      selectedQuantities,\n    }\n  },\n}\n</script>\n\n<style scoped>\n.cart-container {\n  padding-top: 30px;\n  min-width: 950px;\n  background-color: #eeeeee;\n  height: 100vh;\n}\n.cart-container > * {\n  background-color: inherit;\n}\n.contents-container {\n  display: flex;\n  justify-content: space-between;\n  transition: width 0.3s ease;\n  margin-top: 30px;\n}\n.left-container {\n  width: 500px;\n  padding-left: 20px;\n}\n.cart-title {\n  font-size: 40px;\n}\n.cart-card {\n  display: flex;\n  border: 1px solid black;\n  height: 250px;\n  width: 100%;\n  padding-bottom: 20px;\n  background-color: white;\n}\n.cart-card:not(:first-of-type) {\n  margin-top: 30px;\n}\n.cart-card:last-of-type {\n  margin-bottom: 30px;\n}\n.product-photo-container {\n  width: 220px;\n  height: 220px;\n  display: block;\n  margin: 15px;\n}\n.product-photo {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n.product-detail {\n  display: flex;\n  flex-direction: column;\n  padding-top: 20px;\n  align-items: center;\n  flex-direction: column;\n  justify-content: space-between;\n  overflow: auto;\n}\n.product-name {\n  font-size: 24px;\n}\n.product-price {\n  font-size: 24px;\n  margin-top: 10px;\n}\n.select-button-container {\n  display: flex;\n}\n.product-amount-container {\n  display: flex;\n  border-radius: 4px;\n  border: 1.5px solid black;\n  align-items: center;\n}\n.product-amount {\n  border: none;\n}\n.amount {\n  margin: 0 0;\n  padding: 0 3px;\n}\n.size-select-container {\n  display: flex;\n  border-radius: 4px;\n  border: 1.5px solid black;\n  margin-left: 30px;\n  padding: 0 3px;\n}\n.size-select {\n  border: none;\n}\n.size {\n  margin: 0 0;\n}\n.delete-button {\n  background: none;\n  color: inherit;\n  border: none;\n  padding: 0;\n  font: inherit;\n  cursor: pointer;\n  outline: inherit;\n}\n.delete-button:hover {\n  color: aqua;\n  text-decoration: underline;\n}\n.right-container {\n  width: 300px;\n  padding-right: 20px;\n}\n.total-card {\n  width: 100%;\n  height: 270px;\n  font-size: 24px;\n  border: 1px solid black;\n  background-color: white;\n}\n.total-quantity {\n  padding-top: 40px;\n}\n.total-price {\n  margin-top: 20px;\n}\n.buying-procedure-button {\n  margin-top: 50px;\n}\n.buying-procedure-button:hover {\n  background-color: darkgray;\n}\n.return-to-product {\n  font-size: 24px;\n  margin-top: 60px;\n}\n.return-to-product:hover {\n  background-color: darkgray;\n}\n.error-message {\n  margin-top: 5px;\n  color: red;\n  font-size: 18px;\n}\n@media screen and (min-width: 950px) {\n  .left-container {\n    width: 52.63%;\n  }\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}